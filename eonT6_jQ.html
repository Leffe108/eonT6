<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script>


function display_dice(this_roll){
  $("#output2").append( 
    ' ' 
    + this_roll.toString()
  );
};

function display_6(){
  $("#output2").append( 
    ' ' 
    + '6'
  );
};


function roll_one_t6(){
  return Math.floor(
    6 * Math.random() + 1
  );
};


function roll_print_start(rerolls){
  if (rerolls == 0){
    var roll_name = 'First roll:';
  }else{
    var roll_name = 
      'Reroll ' 
      + rerolls.toString() 
      + ':';
  };

  $("#output2").append( 
    '<tr><td>'
    + roll_name
    + '</td><td>'
  );
};
    

function roll_print_end(){
  $("#output2").append('</td></tr>');
};


function roll_with_ob(num_of_t6, rerolls){
  if (num_of_t6 == 0){
    $("#output2").append('</table>');
    return 0;
  };

  var total_sum = 0;
  var num_of_6 = 0;
  var this_roll;

  roll_print_start(rerolls)

  for (i=0; i<num_of_t6; i++){
    this_roll = roll_one_t6();
    if (this_roll == 6){
      num_of_6++;
      display_6();
    }else{
      total_sum += this_roll;
      display_dice(this_roll);
    };
  };

  roll_print_end();

  total_sum += roll_with_ob(2*num_of_6, rerolls+1);
  return total_sum;
};



function roll(){ 
  var num_of_t6 = Math.floor( 
    eval( document.getElementById("t6").value ) 
  ); 
  var extra = Math.floor( 
    eval( document.getElementById("extra").value ) 
  );

  num_of_t6 += Math.floor(extra/4);
  extra -= 4*Math.floor(extra/4);
  $("#output1").html( 
    '<p> ( '
    + document.getElementById("t6").value
    + ' ) T6 + ( '
    + document.getElementById("extra").value
    + ' ) = <b>'
    + num_of_t6.toString() 
    + ' T6 + ' 
    + extra.toString()
    + '</b></p>'
  )
  if (num_of_t6 < 0){
    $("#output2").html('');
    $("#output3").html("I can't roll neggative dices for you");
    return
  }
  $("#output2").html('<table>');
  var total_sum = roll_with_ob(num_of_t6, 0) + extra;
  $("#output3").html( 
    '<p>Total: ' 
    + total_sum.toString()
    +'</p>'
  );
};

</script>
</head>
<body>

<table>
  <tr>
    <td>Number of T6:</tb>
    <td><input type="text" value="2" id="t6"></tb>
  </tr>
  <tr>
    <td>Extra:</tb>
    <td><input type="text" value="0" id="extra"></tb>
  </tr>
</table>
<p>
  <input type="button" id="roll" value="Roll" onClick="roll()">
</p>

<div id="output1">
</div>

<table>
  <div id="output2">
  </div>
</table>

<div id="output3">
</div>


</body>
</html>
